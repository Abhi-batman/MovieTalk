<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MovieTalk</title>

    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Optional: customize Tailwind config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1D4ED8',
                        secondary: '#F59E0B'
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>
     


    <!-- Your custom CSS -->
    <link rel="stylesheet" href="./src/styles.css">
</head>
<button id="createReviewBtn"
    class="fixed bottom-6 right-6 bg-indigo-600 text-white px-5 py-3 rounded-full shadow-lg hover:bg-indigo-700 transition flex items-center space-x-2">
    <span class="text-lg font-semibold">+ Create Review</span>
</button>

<script>
  document.getElementById('createReviewBtn').addEventListener('click',async ()=>{

    try {
      const res=await fetch('http://localhost:5000/api/v1/users/getProfile',{
              method:'GET',
            credentials:'include'})

                if (!response.ok) throw new Error("Couldn't log in ");

            const data = await response.json();
            const user = result.data;

            if (user) {
          
                window.location.href = "/createreview.html";
            } else {
               
                window.location.href = "/signup.html";
            }
    } catch (error) {
       window.location.href = "/signup.html";
    }
  })


</script>

<body class="bg-gray-100 font-sans">


       <!-- Navbar -->
         <nav id="guestnavbar" class="sticky top-0 z-50 w-full bg-white/80 backdrop-blur-md shadow-md transition-all duration-300">
            <div class="max-w-7xl mx-auto flex justify-between items-center px-4 py-2">
                <a href="#" class="flex items-center space-x-2">
                    <img src="https://assets.aceternity.com/logo-dark.png" alt="logo" class="w-8 h-8">
                    <span class="font-bold text-black">MovieTalk</span>
                </a>
                <div class="hidden lg:flex space-x-4">
                    <a href="/" class="px-3 py-2 rounded hover:bg-gray-200">Home</a>
                    <a href="/myreview.html" class="px-3 py-2 rounded hover:bg-gray-200">My Reviews</a>
                   <a href="/signup.html"> <button class="px-3 py-2 rounded bg-blue-600 text-white hover:bg-blue-700">Login / Signup</button>
                </div></a>
                <button id="mobileMenuButton" class="lg:hidden px-3 py-2 rounded bg-gray-200">☰</button>
            </div>
        
           <!-- Mobile Menu -->
             <div id="mobileMenu" class="hidden flex-col px-4 py-2 space-y-2 bg-white shadow-md lg:hidden">
                <a href="/" class="px-3 py-2 rounded hover:bg-gray-200">Home</a>
                <a href="/myreview" class="px-3 py-2 rounded hover:bg-gray-200">My Reviews</a>
               <a href="signup.html"> <button  class="px-3 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 w-full text-left">Login /
                    Signup</button></a>
            </div>
        </nav>  

          <script>
                    // const defaultbutton = document.getElementById('defaultMobileMenuButton');
                    // const defaultmenu = document.getElementById('defaultMobileMenu');
                    // defaultbutton.addEventListener('click', () => {
                    //     defaultmenu.classList.toggle('hidden');
                    // });
        </script>
    <!-- Logged-in Navbar -->
        <nav id="usernavbar" class="sticky top-0 z-50 w-full bg-white/80 backdrop-blur-md shadow-md transition-all duration-300">
            <div class="max-w-7xl mx-auto flex justify-between items-center px-4 py-2">
                <!-- Logo -->
                <a href="#" class="flex items-center space-x-2">
                    <img src="https://assets.aceternity.com/logo-dark.png" alt="logo" class="w-8 h-8">
                    <span class="font-bold text-black">MovieTalk</span>
                </a>
        
                <!-- Desktop Menu -->
                <div class="hidden lg:flex items-center space-x-4">
                    <a href="/" class="px-3 py-2 rounded hover:bg-gray-200">Home</a>
                    <a href="/reviews" class="px-3 py-2 rounded hover:bg-gray-200">My Reviews</a>
        
                    <!-- Profile Avatar -->
                   <div class="relative">
                        <button id="profileButton"
                            class="w-10 h-10 rounded-full overflow-hidden border-2 border-gray-300 focus:outline-none">
                            <img id="avatar" src="https://i.pravatar.cc/100?img=12" alt="Profile" class="w-full h-full object-cover">
                        </button>
         
                        <!-- Dropdown Menu -->
                        <div id="profileDropdown"
                            class="hidden absolute right-0 mt-2 w-48 bg-white border border-gray-200 rounded-md shadow-lg">
                            <a href="/profile" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Profile</a>
                            <a href="/settings" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Settings</a>
                            <hr class="border-gray-200">
                            <a href="/logout" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Logout</a>
                        </div>
                    </div>
                </div>
          
                <!-- Mobile Menu Button -->
                 <button id="mobileMenuButton" class="lg:hidden px-3 py-2 rounded bg-gray-200">☰</button>
            </div>
        
            <!-- Mobile Menu -->
          <div id="mobileMenu" class="hidden flex-col px-4 py-2 space-y-2 bg-white shadow-md lg:hidden">
                <a href="/" class="px-3 py-2 rounded hover:bg-gray-200">Home</a>
                <a href="/reviews" class="px-3 py-2 rounded hover:bg-gray-200">My Reviews</a>
                <div class="flex items-center space-x-2 px-3 py-2 border-t border-gray-200 mt-2">
                    <img src="https://i.pravatar.cc/100?img=12" alt="Profile" class="w-10 h-10 rounded-full object-cover">
                    <span class="text-gray-700 font-semibold">John Doe</span>
                </div>
                <a href="/settings" class="px-3 py-2 rounded hover:bg-gray-200">Settings</a>
                <a href="/logout" class="px-3 py-2 rounded hover:bg-gray-200">Logout</a>
            </div>
        </nav>  



         <script>
            // Mobile menu toggle
            // const button = document.getElementById('loggedInMobileMenuButton');
            // const menu = document.getElementById('loggedInMobileMenu');
            // button.addEventListener('click', () => {
            //     menu.classList.toggle('hidden'); 
            //   });

            // Profile dropdown toggle
            const profileButton = document.getElementById('profileButton');
            const profileDropdown = document.getElementById('profileDropdown');
            profileButton.addEventListener('click', () => {
                profileDropdown.classList.toggle('hidden');
            });

            // Close dropdown if clicked outside
            document.addEventListener('click', (e) => {
                if (!profileButton.contains(e.target) && !profileDropdown.contains(e.target)) {
                    profileDropdown.classList.add('hidden');
                }
            });
         </script> 
         
         <script>
        // navbar
          

        document.addEventListener('DOMContentLoaded',async ()=>{

          

          const guestNavbar=document.getElementById('guestnavbar')
           const userNavbar=document.getElementById('usernavbar')
           const avatar=document.getElementById('avatar')

           try {
            const response=await fetch('http://localhost:5000/api/v1/users/getProfile',{
              method:'GET',
              credentials: "include"
            })

            const data=await response.json()

            if(response.ok){
              guestNavbar.classList.add('hidden')
              userNavbar.classList.remove('hidden')

              if(data?.data?.avatar?.url){
                avatar.src=data?.data?.avatar?.url;
              }
              



              

              



            }else{
               userNavbar.classList.add('hidden');
        guestNavbar.classList.remove('hidden');
            }

           } catch (error) {
             console.error('Error fetching profile:', error);
      userNavbar.classList.add('hidden');
      guestNavbar.classList.remove('hidden');
            
           }


const sentinel=document.getElementById('sentinel')
const container=document.getElementById('cardsContainer')
let page = 1;
  let isLoading = false;

  async function loadMovies() {
    if (isLoading) return;
    isLoading = true;



    
         
//cards


try {
  const responseCard=await fetch(`http://localhost:5000/api/v1/post/getAllPosts?page=${page}`,{
    method:'GET'

  })

  const data=await responseCard.json()
  console.log("Fetched data:", data);


  if(responseCard.ok){
   data.data.posts.forEach(element => {
      const card=document.createElement('div')
      card.className = 'max-w-md w-full bg-white rounded-2xl shadow-md overflow-hidden border border-gray-200 mx-auto my-6';

      card.innerHTML=`<div class="flex items-center justify-between p-4">
    <div class="flex items-center space-x-3">
      <img
        src="${element.user.avatar}"
        alt="Profile"
        class="w-10 h-10 rounded-full object-cover"
      />
      <div>
        <h3 class="text-sm font-semibold text-gray-800">${element.user.fullName}</h3>
        <p class="text-xs text-gray-500">@${element.user.username}</p>
      </div>
    </div>
    <p class="text-xs text-gray-500">2h ago</p>
  </div>

  <!-- Post Image -->
  <div>
    <img
      src="${element.image}"
      alt="Post"
      class="w-full h-64 object-cover"
    />
  </div>

  <!-- Post Content -->
  <div class="p-4">
    <h2 class="text-lg font-bold text-gray-800 mb-2">${element.title}</h2>

    <!-- Rating -->
    <div class="flex items-center mb-3">
      <!-- 4 out of 5 stars example -->
      <div class="flex text-yellow-400 text-lg">
        ★★★★☆
      </div>
      <span class="text-sm text-gray-600 ml-2">4.0 / 5</span>
    </div>

    <p class="text-sm text-gray-600">
     ${element.description}
    </p>
  </div>

      `

    container.appendChild(card)
    });

    page++



  }else{
    observer.unobserve(sentinel);
  }
} catch (error) {
  console.log("Error fetching posts ",error);
  //
}finally {
      isLoading = false;
    }









  }
  const observer = new IntersectionObserver((entries) => {
    const lastEntry = entries[0];
    if (lastEntry.isIntersecting) {
      loadMovies();
    }
  });
   observer.observe(sentinel);

   loadMovies();





})
         
//MYREVIEW CHECK

           
           </script> 




      







     
          
     
    


    <div id="content">
    <main class="p-1">
        <h1 class="text-4xl font-bold text-center mt-10">Discover what others are watching</h1>
        <p class="mt-4 text-center text-gray-700">
            Join our community of movie lovers.Share your thoughts,discover new favourites, and connect with fellow cinephiles.
        </p>
      </main>
  
<div id="cardsContainer">
<!-- 2nd -->
   <div class="max-w-md w-full bg-white rounded-2xl shadow-md overflow-hidden border border-gray-200 mx-auto my-6">
  <!-- Header -->
  <div class="flex items-center justify-between p-4">
    <div class="flex items-center space-x-3">
      <img
        src="https://i.pravatar.cc/100?img=8"
        alt="Profile"
        class="w-10 h-10 rounded-full object-cover"
      />
      <div>
        <h3 class="text-sm font-semibold text-gray-800">Aarav Patel</h3>
        <p class="text-xs text-gray-500">@aaravp</p>
      </div>
    </div>
    <p class="text-xs text-gray-500">2h ago</p>
  </div>

  <!-- Post Image -->
  <div>
    <img
      src="https://images.unsplash.com/photo-1606112219348-204d7d8b94ee"
      alt="Post"
      class="w-full h-64 object-cover"
    />
  </div>

  <!-- Post Content -->
  <div class="p-4">
    <h2 class="text-lg font-bold text-gray-800 mb-2">Inception (2010)</h2>

    <!-- Rating -->
    <div class="flex items-center mb-3">
      <!-- 4 out of 5 stars example -->
      <div class="flex text-yellow-400 text-lg">
        ★★★★☆
      </div>
      <span class="text-sm text-gray-600 ml-2">4.0 / 5</span>
    </div>

    <p class="text-sm text-gray-600">
      A thrilling sci-fi movie that explores dreams within dreams. Must watch!
    </p>
  </div>
</div>


<div id="loader" class="text-center text-gray-600 my-4 hidden">Loading more movies...</div>


<div id="sentinel" class="h-10"></div>
</div>


</div>    



     
       <script>

        

       </script>
    
      

    <script src="./src/script.js"></script>
</body>

</html>